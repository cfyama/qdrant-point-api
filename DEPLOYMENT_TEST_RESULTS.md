# デプロイ環境 API動作テスト結果

**テスト日時**: 2025-11-16
**テスト対象**: https://3j2q4wuiw4.ap-northeast-1.awsapprunner.com
**エンドポイント**: `/api/package-insert/core-sections`

---

## テスト概要

新規追加したPACKAGE_INSERT core-sections APIのデプロイ環境での動作を検証しました。

---

## テスト結果サマリー

| テストケース | 結果 | 詳細 |
|------------|------|------|
| テスト1: 全セクション取得（イコサペント酸エチル） | ✅ 成功 | 4セクション全て取得成功 |
| テスト2: 全セクション取得（ハルシオン） | ✅ 成功 | 4セクション全て取得成功 |
| テスト3: 存在しないYJコード | ✅ 成功 | 全セクション空文字列で正常動作 |
| テスト4: レスポンス構造検証 | ✅ 成功 | 全フィールド存在確認 |

**総合評価: ✅ 全テスト合格**

---

## 詳細テスト結果

### テスト1: YJコード 3399004M1425（イコサペント酸エチル）

**リクエスト:**
```json
{
    "yj_code": "3399004M1425"
}
```

**レスポンス:**
- ステータスコード: `200 OK`
- success: `true`
- yj_code: `3399004M1425`

**取得セクション:**

| セクション | 取得状況 | 文字数 |
|-----------|---------|--------|
| 効能又は効果 (indications) | ✅ | 119文字 |
| 用法及び用量 (dosage_and_administration) | ✅ | 332文字 |
| 禁忌 (contraindications) | ✅ | 180文字 |
| 副作用 (adverse_reactions) | ✅ | 1,322文字 |

**効能又は効果の内容プレビュー:**
```
販売名: イコサペント酸エチルカプセル300mg「杏林」
製造販売元: 東洋カプセル
一般名: イコサペント酸エチル
セクション名: 効能又は効果

# 4 効能又は効果

○閉塞性動脈硬化症に伴う潰瘍、疼痛および冷感の改善

○高脂血症
```

---

### テスト2: YJコード 1124007F1020（ハルシオン）

**リクエスト:**
```json
{
    "yj_code": "1124007F1020"
}
```

**レスポンス:**
- ステータスコード: `200 OK`
- success: `true`
- yj_code: `1124007F1020`

**取得セクション:**

| セクション | 取得状況 | 文字数 |
|-----------|---------|--------|
| 効能又は効果 (indications) | ✅ | 84文字 |
| 用法及び用量 (dosage_and_administration) | ✅ | 292文字 |
| 禁忌 (contraindications) | ✅ | 474文字 |
| 副作用 (adverse_reactions) | ✅ | 2,062文字 |

---

### テスト3: 存在しないYJコード（9999999999999）

**リクエスト:**
```json
{
    "yj_code": "9999999999999"
}
```

**レスポンス:**
- ステータスコード: `200 OK`
- success: `true`
- 全セクション: 空文字列 `""`

**検証:**
✅ データが存在しない場合の正常動作を確認

---

### テスト4: レスポンス構造検証

**検証項目:**

| フィールド | 存在確認 |
|-----------|---------|
| success | ✅ |
| data | ✅ |
| data.yj_code | ✅ |
| data.payload | ✅ |
| payload.indications | ✅ |
| payload.dosage_and_administration | ✅ |
| payload.contraindications | ✅ |
| payload.adverse_reactions | ✅ |

**結果:** ✅ レスポンス構造が仕様通り

---

## API仕様

### エンドポイント
```
POST /api/package-insert/core-sections
```

### リクエスト形式
```json
{
    "yj_code": "string"
}
```

### レスポンス形式
```json
{
    "success": true,
    "data": {
        "yj_code": "62504A4A1023",
        "payload": {
            "indications": "効能又は効果のテキスト...",
            "dosage_and_administration": "用法及び用量のテキスト...",
            "contraindications": "禁忌のテキスト...",
            "adverse_reactions": "副作用のテキスト..."
        }
    }
}
```

### レスポンスフィールド
- `indications`: 効能又は効果（または効能・効果）
- `dosage_and_administration`: 用法及び用量（または用法・用量）
- `contraindications`: 禁忌
- `adverse_reactions`: 副作用

---

## 動作確認項目

✅ **正常系**
- YJコードに対応する4つのセクションが正しく取得できる
- 複数の表記パターン（「効能又は効果」/「効能・効果」）に対応している
- レスポンス構造が仕様通り

✅ **異常系**
- 存在しないYJコードに対して、エラーではなく空データを返す
- タイムアウトなし（30秒以内にレスポンス）

✅ **パフォーマンス**
- レスポンスタイム: 良好（数秒以内）

---

## 結論

デプロイ環境でのPACKAGE_INSERT core-sections APIは**正常に動作**しています。

- ✅ 全テストケースが合格
- ✅ レスポンス構造が仕様通り
- ✅ エラーハンドリングが適切
- ✅ パフォーマンスに問題なし

**本番環境での使用準備完了**
